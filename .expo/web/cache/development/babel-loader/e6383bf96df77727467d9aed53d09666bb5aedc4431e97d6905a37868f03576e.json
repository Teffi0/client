{"ast":null,"code":"var _interopRequireDefault = require(\"@babel/runtime/helpers/interopRequireDefault\");\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.isToday = exports.fetchTasksForSelectedDate = exports.fetchTasksForDetail = exports.fetchTaskParticipants = exports.fetchTaskDetails = exports.fetchTaskDates = exports.fetchServiceNamesByIds = exports.fetchDraftData = exports.SERVER_URL = void 0;\nvar _asyncToGenerator2 = _interopRequireDefault(require(\"@babel/runtime/helpers/asyncToGenerator\"));\nvar _dateFns = require(\"date-fns\");\nvar _axios = _interopRequireDefault(require(\"axios\"));\nvar _asyncStorage = _interopRequireDefault(require(\"@react-native-async-storage/async-storage\"));\nvar SERVER_URL = exports.SERVER_URL = 'http://31.129.101.174';\nvar isToday = exports.isToday = function isToday(date) {\n  var today = new Date();\n  return date.getDate() === today.getDate() && date.getMonth() === today.getMonth() && date.getFullYear() === today.getFullYear();\n};\nvar fetchTaskDates = exports.fetchTaskDates = function () {\n  var _ref = (0, _asyncToGenerator2.default)(function* (setTaskDates) {\n    try {\n      var response = yield _axios.default.get(`${SERVER_URL}/task-dates`);\n      setTaskDates(response.data);\n      yield _asyncStorage.default.setItem('taskDates', JSON.stringify(response.data));\n    } catch (e) {\n      console.error('Ошибка при загрузке индекса дат задач: ', e);\n      setTaskDates({});\n    }\n  });\n  return function fetchTaskDates(_x) {\n    return _ref.apply(this, arguments);\n  };\n}();\nvar fetchTasksForSelectedDate = exports.fetchTasksForSelectedDate = function () {\n  var _ref2 = (0, _asyncToGenerator2.default)(function* (selectedDate, setTasks) {\n    try {\n      var formattedDate = (0, _dateFns.format)(selectedDate, 'yyyy-MM-dd');\n      var response = yield _axios.default.get(`${SERVER_URL}/tasks`, {\n        params: {\n          date: formattedDate\n        }\n      });\n      setTasks(response.data);\n    } catch (e) {\n      console.error('Не удалось загрузить задачи для выбранной даты: ', e);\n      setTasks([]);\n    }\n  });\n  return function fetchTasksForSelectedDate(_x2, _x3) {\n    return _ref2.apply(this, arguments);\n  };\n}();\nvar fetchTasksForDetail = exports.fetchTasksForDetail = function () {\n  var _ref3 = (0, _asyncToGenerator2.default)(function* (setTasks) {\n    try {\n      var response = yield _axios.default.get(`${SERVER_URL}/tasks`);\n      setTasks(response.data);\n    } catch (e) {\n      console.error('Не удалось загрузить задачи для выбранной даты: ', e);\n      setTasks([]);\n    }\n  });\n  return function fetchTasksForDetail(_x4) {\n    return _ref3.apply(this, arguments);\n  };\n}();\nvar fetchServiceNamesByIds = exports.fetchServiceNamesByIds = function () {\n  var _ref4 = (0, _asyncToGenerator2.default)(function* (serviceIds) {\n    try {\n      if (typeof serviceIds !== 'string') {\n        throw new Error('serviceIds должна быть строкой с идентификаторами, разделенными запятой');\n      }\n      if (serviceIds.trim().length === 0) {\n        return {\n          noServices: 'Услуга не выбрана'\n        };\n      }\n      var idsArray = serviceIds.split(',').map(function (id) {\n        return parseInt(id.trim(), 10);\n      });\n      var response = yield _axios.default.post(`${SERVER_URL}/services/names`, {\n        ids: idsArray\n      });\n      return response.data.reduce(function (acc, service) {\n        acc[service.id] = service.service_name;\n        return acc;\n      }, {});\n    } catch (e) {\n      console.error('Ошибка при загрузке названий услуг: ', e);\n      return {};\n    }\n  });\n  return function fetchServiceNamesByIds(_x5) {\n    return _ref4.apply(this, arguments);\n  };\n}();\nvar fetchDraftData = exports.fetchDraftData = function () {\n  var _ref5 = (0, _asyncToGenerator2.default)(function* (taskId) {\n    try {\n      var response = yield _axios.default.get(`${SERVER_URL}/tasks/draft/${taskId}`);\n      return response.data;\n    } catch (error) {\n      console.error('Ошибка при получении данных черновика:', error);\n      throw error;\n    }\n  });\n  return function fetchDraftData(_x6) {\n    return _ref5.apply(this, arguments);\n  };\n}();\nvar fetchTaskParticipants = exports.fetchTaskParticipants = function () {\n  var _ref6 = (0, _asyncToGenerator2.default)(function* (taskId) {\n    try {\n      var response = yield _axios.default.get(`http://31.129.101.174/task-participants/${taskId}`);\n      if (response.data && Array.isArray(response.data)) {\n        return response.data;\n      } else {\n        throw new Error(\"Некорректный формат данных\");\n      }\n    } catch (error) {\n      console.error('Ошибка при получении участников:', error);\n      throw error;\n    }\n  });\n  return function fetchTaskParticipants(_x7) {\n    return _ref6.apply(this, arguments);\n  };\n}();\nvar fetchTaskDetails = exports.fetchTaskDetails = function () {\n  var _ref7 = (0, _asyncToGenerator2.default)(function* (taskId) {\n    try {\n      var response = yield _axios.default.get(`${SERVER_URL}/tasks/${taskId}`);\n      setTask(response.data);\n    } catch (error) {\n      console.error('Ошибка при загрузке деталей задачи:', error);\n    }\n  });\n  return function fetchTaskDetails(_x8) {\n    return _ref7.apply(this, arguments);\n  };\n}();","map":{"version":3,"names":["_dateFns","require","_axios","_interopRequireDefault","_asyncStorage","SERVER_URL","exports","isToday","date","today","Date","getDate","getMonth","getFullYear","fetchTaskDates","_ref","_asyncToGenerator2","default","setTaskDates","response","axios","get","data","AsyncStorage","setItem","JSON","stringify","e","console","error","_x","apply","arguments","fetchTasksForSelectedDate","_ref2","selectedDate","setTasks","formattedDate","format","params","_x2","_x3","fetchTasksForDetail","_ref3","_x4","fetchServiceNamesByIds","_ref4","serviceIds","Error","trim","length","noServices","idsArray","split","map","id","parseInt","post","ids","reduce","acc","service","service_name","_x5","fetchDraftData","_ref5","taskId","_x6","fetchTaskParticipants","_ref6","Array","isArray","_x7","fetchTaskDetails","_ref7","setTask","_x8"],"sources":["C:/Users/fred/Desktop/client/src/utils/tasks.js"],"sourcesContent":["import { format } from 'date-fns';\r\nimport axios from 'axios';\r\nimport AsyncStorage from '@react-native-async-storage/async-storage';\r\n\r\nexport const SERVER_URL = 'http://31.129.101.174';\r\n\r\nexport const isToday = (date) => {\r\n  const today = new Date();\r\n  return date.getDate() === today.getDate() &&\r\n    date.getMonth() === today.getMonth() &&\r\n    date.getFullYear() === today.getFullYear();\r\n};\r\n\r\nexport const fetchTaskDates = async (setTaskDates) => {\r\n  try {\r\n    const response = await axios.get(`${SERVER_URL}/task-dates`);\r\n    setTaskDates(response.data); // Прямо сохраняем данные из ответа сервера\r\n    await AsyncStorage.setItem('taskDates', JSON.stringify(response.data));\r\n  } catch (e) {\r\n    console.error('Ошибка при загрузке индекса дат задач: ', e);\r\n    setTaskDates({});\r\n  }\r\n};\r\n\r\n\r\n\r\nexport const fetchTasksForSelectedDate = async (selectedDate, setTasks) => {\r\n  try {\r\n    const formattedDate = format(selectedDate, 'yyyy-MM-dd');\r\n    const response = await axios.get(`${SERVER_URL}/tasks`, { params: { date: formattedDate } });\r\n    setTasks(response.data);\r\n  } catch (e) {\r\n    console.error('Не удалось загрузить задачи для выбранной даты: ', e);\r\n    setTasks([]);\r\n  }\r\n};\r\n\r\nexport const fetchTasksForDetail = async (setTasks) => {\r\n  try {\r\n    const response = await axios.get(`${SERVER_URL}/tasks`);\r\n    setTasks(response.data);\r\n  } catch (e) {\r\n    console.error('Не удалось загрузить задачи для выбранной даты: ', e);\r\n    setTasks([]);\r\n  }\r\n};\r\n\r\nexport const fetchServiceNamesByIds = async (serviceIds) => {\r\n  try {\r\n    if (typeof serviceIds !== 'string') {\r\n      throw new Error('serviceIds должна быть строкой с идентификаторами, разделенными запятой');\r\n    }\r\n\r\n    // Проверка, есть ли выбранные услуги\r\n    if (serviceIds.trim().length === 0) {\r\n      return { noServices: 'Услуга не выбрана' };\r\n    }\r\n\r\n    // Преобразуем строку в массив чисел\r\n    const idsArray = serviceIds.split(',').map(id => parseInt(id.trim(), 10));\r\n    const response = await axios.post(`${SERVER_URL}/services/names`, { ids: idsArray });\r\n\r\n    // Возвращаем объект с названиями услуг, индексированный по ID услуг\r\n    return response.data.reduce((acc, service) => {\r\n      acc[service.id] = service.service_name;\r\n      return acc;\r\n    }, {});\r\n  } catch (e) {\r\n    console.error('Ошибка при загрузке названий услуг: ', e);\r\n    return {};\r\n  }\r\n};\r\n\r\nexport const fetchDraftData = async (taskId) => {\r\n  try {\r\n    const response = await axios.get(`${SERVER_URL}/tasks/draft/${taskId}`);\r\n    return response.data;\r\n  } catch (error) {\r\n    // Здесь можно более тонко обработать ошибку, возможно, даже возвращать разные ошибки в зависимости от статуса ответа сервера\r\n    console.error('Ошибка при получении данных черновика:', error);\r\n    throw error;\r\n  }\r\n};\r\n\r\nexport const fetchTaskParticipants = async (taskId) => {\r\n  try {\r\n    const response = await axios.get(`http://31.129.101.174/task-participants/${taskId}`);\r\n    if (response.data && Array.isArray(response.data)) {\r\n      return response.data; // Убедитесь, что это массив\r\n    } else {\r\n      throw new Error(\"Некорректный формат данных\");\r\n    }\r\n  } catch (error) {\r\n    console.error('Ошибка при получении участников:', error);\r\n    throw error; // Перебрасываем ошибку дальше\r\n  }\r\n};\r\n\r\nexport const fetchTaskDetails = async (taskId) => {\r\n  try {\r\n    // Загрузка данных о задаче\r\n    const response = await axios.get(`${SERVER_URL}/tasks/${taskId}`);\r\n    setTask(response.data);\r\n  } catch (error) {\r\n    console.error('Ошибка при загрузке деталей задачи:', error);\r\n  }\r\n};"],"mappings":"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"},"metadata":{},"sourceType":"script","externalDependencies":[]}