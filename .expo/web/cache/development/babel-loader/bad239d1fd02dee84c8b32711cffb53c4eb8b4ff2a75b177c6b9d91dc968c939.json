{"ast":null,"code":"import _defineProperty from \"@babel/runtime/helpers/defineProperty\";\nimport _asyncToGenerator from \"@babel/runtime/helpers/asyncToGenerator\";\nimport _slicedToArray from \"@babel/runtime/helpers/slicedToArray\";\nfunction ownKeys(e, r) { var t = Object.keys(e); if (Object.getOwnPropertySymbols) { var o = Object.getOwnPropertySymbols(e); r && (o = o.filter(function (r) { return Object.getOwnPropertyDescriptor(e, r).enumerable; })), t.push.apply(t, o); } return t; }\nfunction _objectSpread(e) { for (var r = 1; r < arguments.length; r++) { var t = null != arguments[r] ? arguments[r] : {}; r % 2 ? ownKeys(Object(t), !0).forEach(function (r) { _defineProperty(e, r, t[r]); }) : Object.getOwnPropertyDescriptors ? Object.defineProperties(e, Object.getOwnPropertyDescriptors(t)) : ownKeys(Object(t)).forEach(function (r) { Object.defineProperty(e, r, Object.getOwnPropertyDescriptor(t, r)); }); } return e; }\nimport React, { useState, useReducer, useEffect, useCallback } from 'react';\nimport View from \"react-native-web/dist/exports/View\";\nimport TouchableOpacity from \"react-native-web/dist/exports/TouchableOpacity\";\nimport Text from \"react-native-web/dist/exports/Text\";\nimport Alert from \"react-native-web/dist/exports/Alert\";\nimport styles from \"../styles/styles\";\nimport TaskForm from \"../components/TaskForm\";\nimport { SuccessModal } from \"../components/SuccessModal\";\nimport { formReducer, initialState } from \"../reducers/formReducer\";\nimport { fetchOptions, handleSaveTask, updateDraft, validateFormData } from \"../utils/taskScreenHelpers\";\nimport PropTypes from 'prop-types';\nimport { SafeAreaView } from 'react-native-safe-area-context';\nimport { jsx as _jsx } from \"react/jsx-runtime\";\nimport { jsxs as _jsxs } from \"react/jsx-runtime\";\nfunction NewTaskScreen(_ref) {\n  var onClose = _ref.onClose,\n    draftData = _ref.draftData,\n    selectedDate = _ref.selectedDate;\n  var _useState = useState(false),\n    _useState2 = _slicedToArray(_useState, 2),\n    isSuccessModalVisible = _useState2[0],\n    setIsSuccessModalVisible = _useState2[1];\n  var _useState3 = useState(false),\n    _useState4 = _slicedToArray(_useState3, 2),\n    isPressed = _useState4[0],\n    setIsPressed = _useState4[1];\n  var addButtonTextStyles = styles.addButtonText;\n  var _useReducer = useReducer(formReducer, initialState),\n    _useReducer2 = _slicedToArray(_useReducer, 2),\n    formData = _useReducer2[0],\n    dispatchFormData = _useReducer2[1];\n  var addButtonTitle = formData.status !== 'отсутствует' ? \"Применить изменения\" : \"Добавить задачу\";\n  var handleSave = useCallback(_asyncToGenerator(function* () {\n    if (formData.status === 'отсутствует') {\n      formData.status = \"новая\";\n    }\n    if (formData.status === 'черновик') {\n      var updatedFormData = _objectSpread(_objectSpread({}, formData), {}, {\n        status: 'новая'\n      });\n      if (validateFormData(updatedFormData)) {\n        yield updateDraft(draftData.id, updatedFormData);\n        setIsSuccessModalVisible(true);\n      }\n    } else {\n      var isValid = yield handleSaveTask(formData);\n      Alert.alert(\"Успешно\", \"Задача успешно добавлена\", [{\n        text: \"OK\",\n        onPress: function onPress() {\n          return onClose();\n        }\n      }]);\n    }\n  }), [formData, draftData]);\n  useEffect(function () {\n    if (draftData) {\n      dispatchFormData({\n        type: 'SET_FORM',\n        payload: draftData\n      });\n    }\n  }, [draftData, dispatchFormData]);\n  var closeSuccessModal = function closeSuccessModal() {\n    setIsSuccessModalVisible(false);\n    onClose();\n  };\n  useEffect(function () {\n    fetchOptions(dispatchFormData);\n  }, []);\n  useEffect(function () {\n    if (selectedDate) {\n      dispatchFormData({\n        type: 'UPDATE_FORM',\n        payload: {\n          startDate: selectedDate\n        }\n      });\n    } else {\n      dispatchFormData({\n        type: 'UPDATE_FORM',\n        payload: {\n          startDate: new Date()\n        }\n      });\n    }\n  }, [selectedDate]);\n  var addButtonStyles = _objectSpread(_objectSpread({}, styles.addButton), isPressed && styles.addButtonPressed);\n  return _jsxs(SafeAreaView, {\n    style: {\n      flex: 1\n    },\n    children: [_jsx(TaskForm, {\n      formData: formData,\n      dispatchFormData: dispatchFormData,\n      onSave: handleSave,\n      onClose: onClose,\n      draftData: draftData\n    }), _jsx(TouchableOpacity, {\n      style: addButtonStyles,\n      onPress: handleSave,\n      children: _jsx(Text, {\n        style: addButtonTextStyles,\n        children: addButtonTitle\n      })\n    }), _jsx(SuccessModal, {\n      isVisible: isSuccessModalVisible,\n      onClose: closeSuccessModal\n    })]\n  });\n}\nNewTaskScreen.propTypes = {\n  onClose: PropTypes.func.isRequired,\n  draftData: PropTypes.object,\n  selectedDate: PropTypes.instanceOf(Date)\n};\nexport default NewTaskScreen;","map":{"version":3,"names":["React","useState","useReducer","useEffect","useCallback","View","TouchableOpacity","Text","Alert","styles","TaskForm","SuccessModal","formReducer","initialState","fetchOptions","handleSaveTask","updateDraft","validateFormData","PropTypes","SafeAreaView","jsx","_jsx","jsxs","_jsxs","NewTaskScreen","_ref","onClose","draftData","selectedDate","_useState","_useState2","_slicedToArray","isSuccessModalVisible","setIsSuccessModalVisible","_useState3","_useState4","isPressed","setIsPressed","addButtonTextStyles","addButtonText","_useReducer","_useReducer2","formData","dispatchFormData","addButtonTitle","status","handleSave","_asyncToGenerator","updatedFormData","_objectSpread","id","isValid","alert","text","onPress","type","payload","closeSuccessModal","startDate","Date","addButtonStyles","addButton","addButtonPressed","style","flex","children","onSave","isVisible","propTypes","func","isRequired","object","instanceOf"],"sources":["C:/Users/fred/Desktop/client/src/screens/NewTaskScreen.js"],"sourcesContent":["import React, { useState, useReducer, useEffect, useCallback } from 'react';\r\nimport { View, TouchableOpacity, Text, Alert } from 'react-native';\r\nimport styles from '../styles/styles';\r\nimport TaskForm from '../components/TaskForm';\r\nimport { SuccessModal } from '../components/SuccessModal';\r\nimport { formReducer, initialState } from '../reducers/formReducer';\r\nimport { fetchOptions, handleSaveTask, updateDraft, validateFormData } from '../utils/taskScreenHelpers';\r\nimport PropTypes from 'prop-types';\r\nimport { SafeAreaView } from 'react-native-safe-area-context';\r\n\r\nfunction NewTaskScreen({ onClose, draftData, selectedDate }) {\r\n  const [isSuccessModalVisible, setIsSuccessModalVisible] = useState(false);\r\n  const [isPressed, setIsPressed] = useState(false);\r\n  const addButtonTextStyles = styles.addButtonText;\r\n  const [formData, dispatchFormData] = useReducer(formReducer, initialState);\r\n  const addButtonTitle = formData.status !== 'отсутствует' ? \"Применить изменения\" : \"Добавить задачу\";\r\n\r\n  const handleSave = useCallback(async () => {\r\n    if (formData.status === 'отсутствует') {\r\n      formData.status = \"новая\";\r\n    }\r\n    if (formData.status === 'черновик') {\r\n      const updatedFormData = { ...formData, status: 'новая' };\r\n      // Валидируем обновленные данные\r\n      if (validateFormData(updatedFormData)) {\r\n        await updateDraft(draftData.id, updatedFormData);\r\n        setIsSuccessModalVisible(true); // Показываем модальное окно об успешном добавлении\r\n      }\r\n    } else {\r\n      // В противном случае обновляем статус и вызываем handleSaveTask\r\n      const isValid = await handleSaveTask(formData);\r\n      Alert.alert(\"Успешно\", \"Задача успешно добавлена\", [\r\n        { text: \"OK\", onPress: () => onClose() } // Закрытие формы при нажатии OK\r\n      ]);\r\n    }\r\n  }, [formData, draftData]);\r\n\r\n  useEffect(() => {\r\n    if (draftData) {\r\n      // Инициализируем форму данными для редактирования\r\n      dispatchFormData({ type: 'SET_FORM', payload: draftData });\r\n    }\r\n  }, [draftData, dispatchFormData]);\r\n\r\n  const closeSuccessModal = () => {\r\n    setIsSuccessModalVisible(false);\r\n    onClose();\r\n  };\r\n\r\n  useEffect(() => {\r\n    fetchOptions(dispatchFormData);\r\n  }, []);\r\n\r\n  useEffect(() => {\r\n    if (selectedDate) {\r\n      // Заполняем начальную дату в formData\r\n      dispatchFormData({ type: 'UPDATE_FORM', payload: { startDate: selectedDate } });\r\n    } else {\r\n      // Если selectedDate не определен, устанавливаем сегодняшнюю дату\r\n      dispatchFormData({ type: 'UPDATE_FORM', payload: { startDate: new Date() } });\r\n    }\r\n  }, [selectedDate]);\r\n\r\n  const addButtonStyles = {\r\n    ...styles.addButton,\r\n    ...(isPressed && styles.addButtonPressed),\r\n  };\r\n\r\n  return (\r\n    <SafeAreaView style={{ flex: 1 }}>\r\n      <TaskForm\r\n        formData={formData}\r\n        dispatchFormData={dispatchFormData}\r\n        onSave={handleSave}\r\n        onClose={onClose}\r\n        draftData={draftData}\r\n      />\r\n      <TouchableOpacity style={addButtonStyles} onPress={handleSave}>\r\n        <Text style={addButtonTextStyles}>{addButtonTitle}</Text>\r\n      </TouchableOpacity>\r\n      <SuccessModal isVisible={isSuccessModalVisible} onClose={closeSuccessModal} />\r\n    </SafeAreaView>\r\n  );\r\n}\r\n\r\nNewTaskScreen.propTypes = {\r\n  onClose: PropTypes.func.isRequired,\r\n  draftData: PropTypes.object,\r\n  selectedDate: PropTypes.instanceOf(Date) // Убираем isRequired\r\n};\r\n\r\nexport default NewTaskScreen;"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}