{"ast":null,"code":"import _asyncToGenerator from \"@babel/runtime/helpers/asyncToGenerator\";\nimport { format, isToday as fnsIsToday } from 'date-fns';\nimport axios from 'axios';\nimport AsyncStorage from '@react-native-async-storage/async-storage';\nexport var SERVER_URL = 'http://31.129.101.174';\nexport var isToday = function isToday(date) {\n  return fnsIsToday(date);\n};\nvar getUserId = function () {\n  var _ref = _asyncToGenerator(function* () {\n    try {\n      var userId = yield AsyncStorage.getItem('userId');\n      return userId ? parseInt(userId, 10) : null;\n    } catch (e) {\n      console.error('Ошибка при получении userId из AsyncStorage:', e);\n      return null;\n    }\n  });\n  return function getUserId() {\n    return _ref.apply(this, arguments);\n  };\n}();\nfunction makeApiRequest(_x, _x2) {\n  return _makeApiRequest.apply(this, arguments);\n}\nfunction _makeApiRequest() {\n  _makeApiRequest = _asyncToGenerator(function* (method, url) {\n    var data = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : null;\n    var params = arguments.length > 3 && arguments[3] !== undefined ? arguments[3] : null;\n    try {\n      var response = yield axios[method](`${SERVER_URL}${url}`, data, {\n        params: params\n      });\n      return response.data;\n    } catch (e) {\n      console.error(`Ошибка при запросе к ${url}: `, e);\n      throw e;\n    }\n  });\n  return _makeApiRequest.apply(this, arguments);\n}\nexport var fetchTaskDates = function () {\n  var _ref2 = _asyncToGenerator(function* (setTaskDates) {\n    var userId = yield getUserId();\n    if (!userId) {\n      console.error('UserId не найден');\n      return;\n    }\n    var url = `/task-dates?userId=${userId}`;\n    var data = yield makeApiRequest('get', url);\n    setTaskDates(data);\n    yield AsyncStorage.setItem('taskDates', JSON.stringify(data));\n  });\n  return function fetchTaskDates(_x3) {\n    return _ref2.apply(this, arguments);\n  };\n}();\nexport var fetchTasksForSelectedDate = function () {\n  var _ref3 = _asyncToGenerator(function* (selectedDate, setTasks) {\n    var userId = yield getUserId();\n    if (!userId) {\n      console.error('UserId не найден');\n      return;\n    }\n    var formattedDate = format(selectedDate, 'yyyy-MM-dd');\n    var url = `/user_tasks?date=${formattedDate}&userId=${userId}`;\n    var data = yield makeApiRequest('get', url);\n    setTasks(data);\n  });\n  return function fetchTasksForSelectedDate(_x4, _x5) {\n    return _ref3.apply(this, arguments);\n  };\n}();\nexport var fetchTasksForCurrentUser = function () {\n  var _ref4 = _asyncToGenerator(function* (selectedDate, setTasks) {\n    var formattedDate = format(selectedDate, 'yyyy-MM-dd');\n    var data = yield makeApiRequest('get', '/user-tasks', null, {\n      date: formattedDate\n    });\n    setTasks(data);\n  });\n  return function fetchTasksForCurrentUser(_x6, _x7) {\n    return _ref4.apply(this, arguments);\n  };\n}();\nexport var fetchServiceNamesByIds = function () {\n  var _ref5 = _asyncToGenerator(function* (serviceIds) {\n    if (typeof serviceIds !== 'string') {\n      throw new Error('serviceIds должна быть строкой с идентификаторами, разделенными запятой');\n    }\n    if (serviceIds.trim().length === 0) {\n      return {\n        noServices: 'Услуга не выбрана'\n      };\n    }\n    var idsArray = serviceIds.split(',').map(function (id) {\n      return parseInt(id.trim(), 10);\n    });\n    var services = yield makeApiRequest('post', '/services/names', {\n      ids: idsArray\n    });\n    return services.reduce(function (acc, service) {\n      acc[service.id] = service.service_name;\n      return acc;\n    }, {});\n  });\n  return function fetchServiceNamesByIds(_x8) {\n    return _ref5.apply(this, arguments);\n  };\n}();\nexport var fetchDraftData = function () {\n  var _ref6 = _asyncToGenerator(function* (taskId) {\n    return yield makeApiRequest('get', `/tasks/draft/${taskId}`);\n  });\n  return function fetchDraftData(_x9) {\n    return _ref6.apply(this, arguments);\n  };\n}();\nexport var fetchTaskParticipants = function () {\n  var _ref7 = _asyncToGenerator(function* (taskId) {\n    var data = yield makeApiRequest('get', `/task-participants/${taskId}`);\n    if (!Array.isArray(data)) {\n      throw new Error(\"Некорректный формат данных\");\n    }\n    return data;\n  });\n  return function fetchTaskParticipants(_x10) {\n    return _ref7.apply(this, arguments);\n  };\n}();\nexport var fetchTaskDetails = function () {\n  var _ref8 = _asyncToGenerator(function* (taskId, setTask) {\n    var data = yield makeApiRequest('get', `/tasks/${taskId}`);\n    setTask(data);\n  });\n  return function fetchTaskDetails(_x11, _x12) {\n    return _ref8.apply(this, arguments);\n  };\n}();","map":{"version":3,"names":["format","isToday","fnsIsToday","axios","AsyncStorage","SERVER_URL","date","getUserId","_ref","_asyncToGenerator","userId","getItem","parseInt","e","console","error","apply","arguments","makeApiRequest","_x","_x2","_makeApiRequest","method","url","data","length","undefined","params","response","fetchTaskDates","_ref2","setTaskDates","setItem","JSON","stringify","_x3","fetchTasksForSelectedDate","_ref3","selectedDate","setTasks","formattedDate","_x4","_x5","fetchTasksForCurrentUser","_ref4","_x6","_x7","fetchServiceNamesByIds","_ref5","serviceIds","Error","trim","noServices","idsArray","split","map","id","services","ids","reduce","acc","service","service_name","_x8","fetchDraftData","_ref6","taskId","_x9","fetchTaskParticipants","_ref7","Array","isArray","_x10","fetchTaskDetails","_ref8","setTask","_x11","_x12"],"sources":["C:/Users/fred/Desktop/client/src/utils/tasks.js"],"sourcesContent":["import { format, isToday as fnsIsToday } from 'date-fns';\r\nimport axios from 'axios';\r\nimport AsyncStorage from '@react-native-async-storage/async-storage';\r\n\r\nexport const SERVER_URL = 'http://31.129.101.174';\r\n\r\n// Упрощенная функция для проверки сегодняшней даты\r\nexport const isToday = (date) => fnsIsToday(date);\r\n\r\nconst getUserId = async () => {\r\n  try {\r\n    const userId = await AsyncStorage.getItem('userId');\r\n    return userId ? parseInt(userId, 10) : null;\r\n  } catch (e) {\r\n    console.error('Ошибка при получении userId из AsyncStorage:', e);\r\n    return null;\r\n  }\r\n};\r\n\r\n// Универсальная функция для запросов к API\r\nasync function makeApiRequest(method, url, data = null, params = null) {\r\n  try {\r\n    const response = await axios[method](`${SERVER_URL}${url}`, data, { params });\r\n    return response.data;\r\n  } catch (e) {\r\n    console.error(`Ошибка при запросе к ${url}: `, e);\r\n    throw e;\r\n  }\r\n}\r\n\r\nexport const fetchTaskDates = async (setTaskDates) => {\r\n  const userId = await getUserId(); // Получаем userId\r\n  if (!userId) {\r\n    console.error('UserId не найден');\r\n    return;\r\n  }\r\n\r\n  const url = `/task-dates?userId=${userId}`; // Добавляем userId в параметры запроса\r\n  const data = await makeApiRequest('get', url);\r\n\r\n  setTaskDates(data);\r\n  await AsyncStorage.setItem('taskDates', JSON.stringify(data));\r\n};\r\n\r\n\r\nexport const fetchTasksForSelectedDate = async (selectedDate, setTasks) => {\r\n  const userId = await getUserId(); // Получаем userId\r\n  if (!userId) {\r\n    console.error('UserId не найден');\r\n    return;\r\n  }\r\n\r\n  const formattedDate = format(selectedDate, 'yyyy-MM-dd');\r\n  const url = `/user_tasks?date=${formattedDate}&userId=${userId}`;\r\n  const data = await makeApiRequest('get', url);\r\n\r\n  setTasks(data);\r\n};\r\n\r\nexport const fetchTasksForCurrentUser = async (selectedDate, setTasks) => {\r\n  const formattedDate = format(selectedDate, 'yyyy-MM-dd');\r\n  const data = await makeApiRequest('get', '/user-tasks', null, { date: formattedDate });\r\n\r\n  setTasks(data);\r\n};\r\n\r\nexport const fetchServiceNamesByIds = async (serviceIds) => {\r\n  if (typeof serviceIds !== 'string') {\r\n    throw new Error('serviceIds должна быть строкой с идентификаторами, разделенными запятой');\r\n  }\r\n  if (serviceIds.trim().length === 0) {\r\n    return { noServices: 'Услуга не выбрана' };\r\n  }\r\n  const idsArray = serviceIds.split(',').map(id => parseInt(id.trim(), 10));\r\n  const services = await makeApiRequest('post', '/services/names', { ids: idsArray });\r\n  return services.reduce((acc, service) => {\r\n    acc[service.id] = service.service_name;\r\n    return acc;\r\n  }, {});\r\n};\r\n\r\nexport const fetchDraftData = async (taskId) => {\r\n  return await makeApiRequest('get', `/tasks/draft/${taskId}`);\r\n};\r\n\r\nexport const fetchTaskParticipants = async (taskId) => {\r\n  const data = await makeApiRequest('get', `/task-participants/${taskId}`);\r\n  if (!Array.isArray(data)) {\r\n    throw new Error(\"Некорректный формат данных\");\r\n  }\r\n  return data;\r\n};\r\n\r\nexport const fetchTaskDetails = async (taskId, setTask) => {\r\n  const data = await makeApiRequest('get', `/tasks/${taskId}`);\r\n  setTask(data);\r\n};\r\n"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}